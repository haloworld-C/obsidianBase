**Position and heading constraints**: For every state on the result, the four circles representing the vehicle shape have to be within the bounds calculated above. So the connection between the vehicle states and the position of the circles are built:  [![](https://camo.githubusercontent.com/9a68857bce6405fdf21ed5f6b92eb30bd215882e2cc347e206cf864bc9e33c7b/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f655f7b5c746578747b637d2c697d5e6b2673706163653b5c617070726f782673706163653b655f7b792c697d2673706163653b26706c75733b2673706163653b6c5e6b2673706163653b5c74616e2673706163653b655f7b5c7068692c2673706163653b697d2673706163653b5c617070726f782673706163653b655f7b792c697d2673706163653b26706c75733b2673706163653b6c5e6b2673706163653b655f7b5c7068692c2673706163653b697d "e_{\text{c},i}^k \approx e_{y,i} + l^k \tan e_{\phi, i} \approx e_{y,i} + l^k e_{\phi, i}")](https://www.codecogs.com/eqnedit.php?latex=e_{\text{c},i}^k&space;\approx&space;e_{y,i}&space;&plus;&space;l^k&space;\tan&space;e_{\phi,&space;i}&space;\approx&space;e_{y,i}&space;&plus;&space;l^k&space;e_{\phi,&space;i})[![](https://camo.githubusercontent.com/e70ce138263c53fc66589cb18e6e532cc4401e62c0b3617dac2546f5e3e71414/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f2c6b3d312c322c332c34 ",k=1,2,3,4")](https://www.codecogs.com/eqnedit.php?latex=,k=1,2,3,4). As stated before, [![](https://camo.githubusercontent.com/38c372fef983e022ec3469aba048822ed0a9486c910bba83f53c653fbb7b17b6/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f655e6b5f7b5c746578747b637d2c697d2673706163653b5c696e2673706163653b5b625e6b5f7b5c6d696e2c697d2c2673706163653b625e6b5f7b5c6d61782c697d5d2c6b3d312c322c332c34 "e^k_{\text{c},i} \in [b^k_{\min,i}, b^k_{\max,i}],k=1,2,3,4")](https://www.codecogs.com/eqnedit.php?latex=e^k_{\text{c},i}&space;\in&space;[b^k_{\min,i},&space;b^k_{\max,i}],k=1,2,3,4).  
**Soft constraints on safety margin**: Apply soft constraints on one of the circles. Take the forth circle for example: [![](https://camo.githubusercontent.com/a651cdc133e605543cf2deeb8fa3340e2a8690916c9b05905329eb7d9215673b/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f625f7b5c746578747b6d696e7d2c697d5e3426706c75733b645f7b5c746578747b736166657d7d2d5c657073696c6f6e5f7b5c746578747b736166657d2c697d2673706163653b5c6c65712673706163653b655f7b632c697d5e342673706163653b5c6c65712673706163653b625f7b5c746578747b6d61787d2c697d5e342d645f7b5c746578747b736166657d7d26706c75733b5c657073696c6f6e5f7b5c746578747b736166657d2c697d2c2673706163653b5c2673706163653b5c657073696c6f6e5f7b5c746578747b736166657d2c697d3e30 "b_{\text{min},i}^4+d_{\text{safe}}-\epsilon_{\text{safe},i} \leq e_{c,i}^4 \leq b_{\text{max},i}^4-d_{\text{safe}}+\epsilon_{\text{safe},i}, \ \epsilon_{\text{safe},i}>0")](https://www.codecogs.com/eqnedit.php?latex=b_{\text{min},i}^4&plus;d_{\text{safe}}-\epsilon_{\text{safe},i}&space;\leq&space;e_{c,i}^4&space;\leq&space;b_{\text{max},i}^4-d_{\text{safe}}&plus;\epsilon_{\text{safe},i},&space;\&space;\epsilon_{\text{safe},i}%3E0). [![](https://camo.githubusercontent.com/d8dc1e739eb2c2a2f69d49d42549357475a56b4f37463cdde21437075abbe18c/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f645f7b5c746578747b736166657d7d "d_{\text{safe}}")](https://www.codecogs.com/eqnedit.php?latex=d_{\text{safe}}) is a fixed safety margin, [![](https://camo.githubusercontent.com/d00bfb900d01027a5e76198335530f8ed13af6760d04daacc83e2265fd83eeae/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c657073696c6f6e5f7b5c746578747b736166657d2c697d "\epsilon_{\text{safe},i}")](https://www.codecogs.com/eqnedit.php?latex=\epsilon_{\text{safe},i}) is the slack variable.  
**Curvature constraints**: [![](https://camo.githubusercontent.com/e03e4d634b2ecf24693cc4ae6e3d2525a41c193bc58f2676a04cafc9867c8967/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f6b5f692673706163653b5c696e2673706163653b5b6b5f7b5c6d696e2c697d2c6b5f7b5c6d61782c2673706163653b697d5d "k_i \in [k_{\min,i},k_{\max, i}]")](https://www.codecogs.com/eqnedit.php?latex=k_i&space;\in&space;[k_{\min,i},k_{\max,&space;i}]) .  
**Initial state and target state constraints**: [![](https://camo.githubusercontent.com/1a14bc95a5dae86a4782d030d6f8c648a8dd8a8985d8df20ca0fe174427776df/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f7a5f312673706163653b3d2673706163653b7a5f7b5c746578747b63757272656e747d7d2c5c2673706163653b7a5f7b4e7d2673706163653b3d2673706163653b7a5f7b5c746578747b676f616c7d7d "z_1 = z_{\text{current}},\ z_{N} = z_{\text{goal}}")](https://www.codecogs.com/eqnedit.php?latex=z_1&space;=&space;z_{\text{current}},\&space;z_{N}&space;=&space;z_{\text{goal}}).